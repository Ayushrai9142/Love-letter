<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>confirmation</title>
    <link rel="stylesheet" href="styles.css">

    <!-- ✅ Google Site Verification -->
    <meta name="google-site-verification" content="jnphjQTW-i8neDl8TrT6alPY0zyY1kQ2sZLq9L3TSik">

    <!-- ✅ Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SJWLXHTLJL"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-SJWLXHTLJL'); // Apni Google Analytics Tracking ID replace karo
    </script>

    <!-- ✅ Firebase CDN -->
    <script type="module" src="https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js"></script>
</head>
<body>
    <div class="container">
        <h2> Successfully!</h2>
        <p>We will verify your name and send your personalized love letter link soon.</p>
        <p>If you have any questions, contact us at: 
            <a href="mailto:ayushrai@gmail.com">ayushrai@gmail.com</a>
        </p>
        <p>Click here to view your personalized love letter: 
            <a id="loveLetterLink" href="#">Loading...</a>
        </p>
        <a href="index.html" class="btn">Go to Homepage</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";

        // ✅ Firebase Config Fetch Function
        async function getFirebaseConfig() {
            const response = await fetch("/.netlify/functions/firebaseConfig");
            const { firebaseConfig } = await response.json();
            return firebaseConfig;
        }

        // ✅ Initialize Firebase and Check Authentication
        async function checkAuth() {
            const firebaseConfig = await getFirebaseConfig();
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);

            onAuthStateChanged(auth, (user) => {
                if (!user) {
                    // ✅ User not logged in, redirect to login page
                    window.location.href = "login.html";
                }
            });
        }

        checkAuth(); // Call authentication check function

        // ✅ Load User Details & Generate Love Letter Link
        setTimeout(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const senderName = urlParams.get("sender") || "Someone Special";
            const recipientName = urlParams.get("recipient") || "Dear";
            const customMessage = urlParams.get("message") ? decodeURIComponent(urlParams.get("message")) : "";

            // ✅ Generating Love Letter URL
            const loveLetterURL = `love-letter.html?sender=${encodeURIComponent(senderName)}&recipient=${encodeURIComponent(recipientName)}&message=${encodeURIComponent(customMessage)}`;

            // ✅ Updating the link with correct URL
            document.getElementById("loveLetterLink").href = loveLetterURL;
            document.getElementById("loveLetterLink").textContent = "Click here!";
        }, 2000);
    </script>
</body>
</html>
